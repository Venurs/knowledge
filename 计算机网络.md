[TOC]

# 网络分层

| 七层所在层(模型) | 协议                                               | 数据格式               | 备注                                                         |
| ---------------- | -------------------------------------------------- | ---------------------- | ------------------------------------------------------------ |
| 应用层           | HTTP，FTP，（ NFS，SNMP）UDP协议， SMTP， WWW，DNS | 应用数据协议单元(APDU) | 与其他计算机进行通讯的一个应用                               |
| 表示层           | JPEG， ASCII数据格式                               | 表示协议数据单元(PPDU) | 定义数据格式及加密，如FTP允许选择二进制或者ASCII格式传输，数据翻译 加密压缩 |
| 会话层           | NFS， SQL， RPC                                    | 会话协议数据单元SPDU   | 定义开始 控制和结束一个会话，包括对多个双向消息的控制和管理，建立 管理 终止会话 |
| 传输层           | TCP，UDP， SPX                                     | 段                     | 选择差错恢复协议或者无差错恢复协议，端到端的报文传递和错误恢复 |
| 网络层           | TCP/IP簇                                           | 包                     | 数据从源到目的的传送                                         |
| 数据链路层       | 网桥，交换机                                       | 数据帧                 | 数据组装成帧和点到点的传递                                   |
| 物理层           | 中继器，网关，集线器                               | 比特                   | 媒介传输比特流                                               |

| 所在层     | 备注                                                   |      |
| ---------- | ------------------------------------------------------ | ---- |
| 应用层     | 针对某些应用提供服务                                   |      |
| 传输层     | 将网络层的数据送到进程，负责进程和主机之间的传输       |      |
| 网络层     | 将包里面的目的地址取出进行路由选择，将数据发往目的主机 |      |
| 数据连接层 | 通过物理网络传送包，包指的是通过网络层交过来的数据报   |      |
| 物理层     | 线路传送原始的比特流                                   |      |



# 常见协议

## TCP/IP

是一组协议，包括TCP， IP， UDP，ARP

`自己的csdn博客有`

`https://blog.csdn.net/weixin_40389301/article/details/80310483`

## TCP

全双工通信：允许通信双方的应用进程在任何时候都能发送数据，连接的两端设有发送缓存和接收缓存，用来临时存放双向通信的数据

面向字节流：指流入到进程或从进程流出的字节序列；虽然应用程序和TCP的交互是一次一个数据块，但是TCP把应用程序交付下来的数据看成是一连串的无结构字节流

TCP的消息无边界机制：

在socket编程中，TCP和UDP分别面向连接和非面向连接，同时由于TCP是面向数据流的，所以TCP的编程当中，收发两端都有成对的socket，发送端为了将多个发往接收端的包更有效的发送，采用了Nagle算法进行优化，将多次间隔小且数据量小的数据合并成了一个大的数据块，然后进行封包，这样对于接收端就难以分辨出来了，需要提供科学的拆包机制，这就是TCP的沾包问题，是由于TCP无消息保护边界导致的，UDP由于是面向数据报的所以有消息保护机制，这样可以减少发送包的数量，减少额外开支，对于接收端来说，机器负荷很重，会在接受缓冲里沾包，适合数据要求可靠传输的但是不需要太频繁传输场合，两次操作间隔100ms，具体是由TCP等待发送间隔决定的，取决于内核中的socket写法

无保护消息边界的解决办法：

1. 发送固定长度的消息
2. 把消息的尺寸与消息一块发送
3. 使用特殊标记来区分消息间隔
4. 关闭优化算法，强制数据立即发送，不用等缓冲区满， 会降低网络发送效率，影响应用程序的性能



## UDP

每一个消息是独立的，有保护消息边界，但是发送数据量较小的时候，就会发生数据报有效载荷较小的情况，这会增加多次发送的开销和接受开销，因此需要设定一个比较合适的数据包的包长，UDP最大载荷味1472

## 对比

| 协议   | TCP                            | UDP                  |
| ------ | ------------------------------ | -------------------- |
| 名称   | 传输控制协议                   | 用户数据报协议       |
| 连接   | 面向连接                       | 无连接               |
| 可靠性 | 可靠                           | 不可靠传送服务       |
| 通信   | 全双工通信                     |                      |
|        | 面向字节流                     | 面向数据报           |
|        | 传输层协议                     | 传输层协议           |
|        | 数据量大，有确认机制和重传机制 | 传输数据量小，开销低 |
|        | 速度慢                         | 速度快               |
| 用途   |                                | 单播 多播 广播 组播  |



## HTTP

介绍：超文本传输协议，应用层上的一种c/s模型的通信协议，承载于TCP协议之上，由请求和响应构成，且无状态的，默认端口号80，

缺点：

1. 通信使用明文，内容可能会被窃听，产生中间人攻击
2. 不验证通信方的身份，可能遭遇伪装
3. 无法证明报文的完整性

特点：

1. 协议：规定了通信双方必须遵守的数据传输格式，双方按照约定的格式才能准确的通信
2. 无状态：指两次连接通信之间是没有任何关系的。每次都是一个新的连接，服务端无法记录前后的请求信息
3. 客户端/服务端模型
4. 处于五层网络模型当中的应用层。通常承载于TLS或SSl协议层之上，这时候就成了常说的Https

状态码：

| 状态码 | 含义                                      |
| ------ | ----------------------------------------- |
| 100    | continue，客户端继续发送请求              |
| 200    | OK                                        |
| 300    | 重定向，请求的资源临时从不同的URi响应请求 |
| 400    | Bad Request                               |
| 403    | Forbidden                                 |
| 401    | Unauthorized 当前请求需要身份识别         |
| 404    | Not Found，请求失败，未找到资源           |
| 405    | Method Not Allowed                        |
| 408    | Request Timeout                           |
| 500    | Internal Server Error                     |
| 502    | BadGateway                                |
| 600    | 源站没有返回响应头部，只返回实体内容      |



### 跨域问题

CORS跨域资源共享，克服了ajax只能同源使用的限制

CORS需要浏览器和服务器同时支持，目前所有的浏览器都支持该功能

浏览器将CORS请求分成简单请求和非简单请求

简单请求：方法：HEAD，GET，POST；头信息不超出：Accept， Accept-language， Content-Language， Last-Event-ID， Content-type

客户端在请求头中，增加Origin字段，表示该请求来自于哪个源，

浏览器根据服务端的返回是否包含Access-Control-Allow-Origin字段来判断是否出错，如果服务端允许则相应中应包含，Access-Control-Allow-Origin，Credentials，Headers，Context-Type，前三个都与cors有关

非简单请求：请求方式是PUT或者DELETE， Content-Type类型是application/json

正式通信之前会增加一次HTTP查询请求，成为预检请求，询问当前请求是否允许跨域，之后再发出正式请求





与jsonp比较：

jsonp利用的是dom当中的script标签当中的src不受同源策略的限制的原理

jsonp支持get请求，cors支持所有请求类型，jsonp优势在于支持比较老的浏览器，以及可以向不支持CORS的网站请求数据

## HTTPS

端口443，http+ssl，传输加密,解决了HTTP传输不安全的问题，

采用ssl进行非对称加密

如果采用对称加密的话。那么第一次传输密钥的时候也是明文，例如AES

非对称加密：公钥加密只能用私钥进行解密，反之亦然，但为了防止中间人修改加密，所以出现了权威的证书颁发机构(CA)

证书原理：

服务端将公钥发送到权威机构，申请证书，机构使用私钥加密服务端公钥，通过服务端网址等信息生成一个证书签名，证书签名经过私钥加密，制作完成后发送给服务端

客户端通信的时候获取证书，向权威机构验证，浏览器维护了所有权威机构的证书和公钥，可以从本地找到对应的机构公钥，客户端利用机构公钥解密服务端公钥



## DNS

域名解析，基于UDP，默认端口53，解析方式由递归解析和迭代解析，使用本地缓存和路由器缓存提高效率。

## FTP

文件传输协议，基于TCP，TCP实现不同网络主机之间的文件传输需求，端口21

SFTP安全的文件传输协议，给予SSH，通过网络传输文件，要求客户端必须有通过服务器的安全通道SSH进行，不传输明文

## DHCP

动态主机配置协议

## SMTP邮件服务

一般端口25，

1. SMTP 只支持传输文本，MIME 支持多媒体类型传输
2. 访问邮件服务器POP-3(简单上传下载), IMAP-4(可以在邮件服务器中直接对邮件进行操作)

邮局协议版本3POP-3，端口号110